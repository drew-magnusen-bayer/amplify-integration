const objectHash = require('object-hash')

module.exports = (cache) => ({
    get({
        clientId,
        clientSecret,
        url,
        scope = url.includes('login.microsoft.com') ? 'https://graph.microsoft.com/.default' : ''
    }) {
        const key = objectHash({clientId, clientSecret, url, scope})

        if (!cache[key]) {
            throw new Error('Could not find cached credentials for config: ', {
                clientId,
                url,
                scope
            })
        }
        return cache[key].value
    }
})
