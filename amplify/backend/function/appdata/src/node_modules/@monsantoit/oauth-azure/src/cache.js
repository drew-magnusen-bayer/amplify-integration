const objectHash = require('object-hash')

module.exports = (cache) => ({
    get({
        clientId,
        clientSecret,
        url = 'https://login.microsoftonline.com/fcb2b37b-5da0-466b-9b83-0014b67a7c78/oauth2/v2.0/token',
        scope = `${clientId}/.default`
    }) {
        const key = objectHash({clientId, clientSecret, url, scope})

        if (!cache[key]) {
            throw new Error(
                `Could not find cached credentials for config: ${JSON.stringify({
                    clientId,
                    url,
                    scope
                })}`
            )
        }

        return cache[key].value
    }
})
