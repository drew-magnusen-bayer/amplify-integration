FROM python:3.8-slim AS builder

WORKDIR /usr/src/app

COPY pages ./pages
COPY requirements.txt .
COPY mkdocs.yml .

RUN pip3 install --trusted-host pypi.python.org --trusted-host pypi.org --trusted-host files.pythonhosted.org -r ./requirements.txt
RUN mkdocs build

# Server Setup
FROM nginx:alpine AS server
WORKDIR /usr/src/app

ENV NODE_OPTIONS="--max-http-header-size=64000"

RUN rm -v /etc/nginx/nginx.conf
COPY --from=builder /usr/src/app/site /usr/share/nginx/html
ADD nginx.conf /etc/nginx

EXPOSE 80
