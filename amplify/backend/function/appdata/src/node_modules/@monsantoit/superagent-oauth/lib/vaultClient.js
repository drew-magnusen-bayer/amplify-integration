const VaultAwsAuth = require("vault-auth-aws")
const nodeVault = require("node-vault")

const create = async (role) => {
  const vaultClient = new VaultAwsAuth({
    host: "vault.agro.services",
    ssl: true,
    port: 443,
    vaultAppName: role,
  })
  const vaultToken = await vaultClient.authenticate()
  return nodeVault({
    apiVersion: "v1",
    endpoint: "https://vault.agro.services",
    token: vaultToken.auth.client_token,
  })
}

module.exports = { create }
